<!DOCTYPE html>
<html>
<head>
  <title>Average Points Per Frame</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <header>
    <h1>Average Points Per Frame</h1>
  </header>

  <div id="chart" style="max-width: 900px; margin: auto; padding: 20px;"></div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQw8aR1Pkr3bqV9p7_OKcz55dVe2rQhwvgGc0AjNGlBn7oFPND4wTarjt9_N_GfnTVSA1snsieYYJ1o/pub?gid=0&single=true&output=csv";

    function updateChart() {
      fetch(csvUrl)
        .then(response => response.text())
        .then(csv => {
          const parsed = Papa.parse(csv, { header: true });
          const rows = parsed.data;

          const playerStats = {};

          rows.forEach(row => {
            const p1 = row["Player 1"];
            const f1 = parseInt(row["Frames 1"]);
            const pts1 = parseInt(row["Points 1"]);
            const p2 = row["Player 2"];
            const f2 = parseInt(row["Frames 2"]);
            const pts2 = parseInt(row["Points 2"]);

            if (p1 && !isNaN(f1) && !isNaN(pts1)) {
              if (!playerStats[p1]) playerStats[p1] = { totalPoints: 0, totalFrames: 0 };
              playerStats[p1].totalPoints += pts1;
              playerStats[p1].totalFrames += f1;
            }

            if (p2 && !isNaN(f2) && !isNaN(pts2)) {
              if (!playerStats[p2]) playerStats[p2] = { totalPoints: 0, totalFrames: 0 };
              playerStats[p2].totalPoints += pts2;
              playerStats[p2].totalFrames += f2;
            }
          });

          const players = Object.keys(playerStats);
          const data = players.map(player => {
            const { totalPoints, totalFrames } = playerStats[player];
            const avg = totalFrames === 0 ? 0 : totalPoints / totalFrames;
            return { player, avg };
          });

          const sorted = data.sort((a, b) => b.avg - a.avg);

          const x = sorted.map(d => d.player);
          const y = sorted.map(d => d.avg);

          Plotly.newPlot('chart', [{
            x,
            y,
            type: 'bar',
            text: y.map(a => a.toFixed(1)),
            textposition: 'outside',
            marker: { color: '#4CAF50' }
          }], {
            title: 'Average Points Per Frame',
            yaxis: { title: 'Points per Frame', rangemode: 'tozero' },
            margin: { t: 50 }
          });
        });
    }

    updateChart();
    setInterval(updateChart, 30000);
  </script>
</body>
</html>
